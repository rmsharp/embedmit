<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Encoding Categorical Data • embedmit</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Encoding Categorical Data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">embedmit</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/categorical-encoding-01.html">Encoding Categorical Data</a></li>
    <li><a class="dropdown-item" href="../articles/categorical-encoding.html">Encoding Categorical Data</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/GLM.html">Using Generalized Linear Models</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/Tensorflow.html">Entity Embeddings of Categorical Variables using TensorFlow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rmsharp/embedmit/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Encoding Categorical Data</h1>
            <h3 data-toc-skip class="subtitle">Effect Encodings with
embedmit</h3>
                        <h4 data-toc-skip class="author">Based on
Chapter 17 of Tidy Modeling with R</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmsharp/embedmit/blob/main/vignettes/categorical-encoding-01.Rmd" class="external-link"><code>vignettes/categorical-encoding-01.Rmd</code></a></small>
      <div class="d-none name"><code>categorical-encoding-01.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates categorical encoding techniques using
<code>embedmit</code>, closely following the approach from <a href="https://www.tmwr.org/categorical" class="external-link">Chapter 17 of Tidy Modeling with
R</a> by Max Kuhn and Julia Silge.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>For many models, the predictors must be encoded as numbers before
modeling. The most common encoding for categorical variables is to
create <em>dummy</em> or <em>indicator</em> variables. However, when a
categorical variable has many levels (high cardinality), dummy encoding
creates many columns and can lead to issues with:</p>
<ul>
<li>Computational efficiency</li>
<li>Overfitting on rare categories</li>
<li>Handling new/unseen categories at prediction time</li>
</ul>
<p>This chapter explores <em>effect encodings</em> (also called
likelihood encodings) as an alternative approach that replaces
categorical variables with numeric values representing their
relationship to the outcome.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmsharp/embedmit" class="external-link">embedmit</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the Ames housing data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create train/test split</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">502</span><span class="op">)</span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span><span class="va">ames</span>, prop <span class="op">=</span> <span class="fl">0.80</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="is-an-encoding-necessary">Is an Encoding Necessary?<a class="anchor" aria-label="anchor" href="#is-an-encoding-necessary"></a>
</h2>
<p>Before diving into encoding strategies, it’s worth noting that some
models can handle categorical predictors natively:</p>
<ul>
<li>
<strong>Tree-based models</strong> (decision trees, random forests,
boosted trees) can use categorical variables directly by finding optimal
splits</li>
<li>
<strong>Naive Bayes</strong> models compute class probabilities
without requiring numeric encoding</li>
</ul>
<p>For these models, converting categories to dummy variables typically
doesn’t improve performance and may even hurt it. The
<code>recipes</code> package provides <code><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy()</a></code> for
standard dummy encoding when needed.</p>
</div>
<div class="section level2">
<h2 id="using-the-outcome-for-encoding-predictors">Using the Outcome for Encoding Predictors<a class="anchor" aria-label="anchor" href="#using-the-outcome-for-encoding-predictors"></a>
</h2>
<p>Effect encodings (sometimes called likelihood or target encodings)
replace categorical levels with a numeric value that represents the
relationship between that level and the outcome. This approach:</p>
<ol style="list-style-type: decimal">
<li>Reduces a high-cardinality categorical to a single numeric
column</li>
<li>Naturally handles novel categories at prediction time</li>
<li>Can incorporate regularization to prevent overfitting</li>
</ol>
<div class="section level3">
<h3 id="visualizing-neighborhood-effects">Visualizing Neighborhood Effects<a class="anchor" aria-label="anchor" href="#visualizing-neighborhood-effects"></a>
</h3>
<p>The Ames data has 28 different neighborhoods. Let’s visualize how
sale price varies across them:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span>,</span>
<span>    std_err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">mean</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="fl">1.64</span> <span class="op">*</span> <span class="va">std_err</span>, xmax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="fl">1.64</span> <span class="op">*</span> <span class="va">std_err</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"Price (mean, log scale)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="categorical-encoding-01_files/figure-html/neighborhood-viz-1.png" class="r-plt" alt="Mean sale price by neighborhood with 90% confidence intervals. Neighborhoods are ordered by their mean sale price." width="672"><p class="caption">
Mean sale price by neighborhood with 90% confidence intervals.
Neighborhoods are ordered by their mean sale price.
</p>
</div>
<p>Some neighborhoods (like Northridge Heights, Stone Brook) command
premium prices, while others (like Meadow Village, Iowa DOT and Rail
Road) are associated with lower prices.</p>
</div>
<div class="section level3">
<h3 id="glm-based-effect-encoding">GLM-Based Effect Encoding<a class="anchor" aria-label="anchor" href="#glm-based-effect-encoding"></a>
</h3>
<p>The <code><a href="../reference/step_lencode_glm.html">step_lencode_glm()</a></code> function uses a generalized
linear model to estimate the effect of each category level. The recipe
below demonstrates the approach:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_glm</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_lencode_glm.html">step_lencode_glm</a></span><span class="op">(</span><span class="va">Neighborhood</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html" class="external-link">step_interact</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html" class="external-link">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_glm</span></span></code></pre></div>
<p>We can examine the learned encodings by preparing the recipe and
using <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_estimates</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">ames_glm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_estimates</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 29 × 4</span></span></span>
<span><span class="co">#&gt;    level                value terms        id               </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> North_Ames         <span style="text-decoration: underline;">144</span>416. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> College_Creek      <span style="text-decoration: underline;">202</span>763. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Old_Town           <span style="text-decoration: underline;">124</span>999. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Edwards            <span style="text-decoration: underline;">130</span>460. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Somerset           <span style="text-decoration: underline;">232</span>310. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Northridge_Heights <span style="text-decoration: underline;">321</span>119. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Gilbert            <span style="text-decoration: underline;">191</span>159. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Sawyer             <span style="text-decoration: underline;">137</span>208. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Northwest_Ames     <span style="text-decoration: underline;">188</span>726. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Sawyer_West        <span style="text-decoration: underline;">182</span>651. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19 more rows</span></span></span></code></pre></div>
<p>Each neighborhood is replaced by a single numeric value representing
its effect on sale price (on the log scale). Higher values indicate
neighborhoods associated with higher prices.</p>
</div>
<div class="section level3">
<h3 id="handling-novel-categories">Handling Novel Categories<a class="anchor" aria-label="anchor" href="#handling-novel-categories"></a>
</h3>
<p>A key advantage of effect encoding is graceful handling of categories
not seen during training. The encoding includes a special
<code>..new</code> level:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">level</span> <span class="op">==</span> <span class="st">"..new"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   level   value terms        id               </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ..new <span style="text-decoration: underline;">183</span>150. Neighborhood lencode_glm_yj20u</span></span></code></pre></div>
<p>When the model encounters an unseen neighborhood at prediction time,
it uses this default encoding (typically close to the overall mean).</p>
</div>
<div class="section level3">
<h3 id="effect-encodings-with-partial-pooling">Effect Encodings with Partial Pooling<a class="anchor" aria-label="anchor" href="#effect-encodings-with-partial-pooling"></a>
</h3>
<p>The GLM approach estimates each neighborhood’s effect independently.
For neighborhoods with few observations, these estimates can be
unreliable.</p>
<p>The <code><a href="../reference/step_lencode_mixed.html">step_lencode_mixed()</a></code> function uses
<em>hierarchical</em> or <em>mixed effects</em> models that apply
<strong>partial pooling</strong>. This shrinks estimates toward the
overall mean, with more shrinkage for categories with fewer
observations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_mixed</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_lencode_mixed.html">step_lencode_mixed</a></span><span class="op">(</span><span class="va">Neighborhood</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html" class="external-link">step_interact</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html" class="external-link">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_mixed</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_estimates</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">ames_mixed</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mixed_estimates</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 29 × 4</span></span></span>
<span><span class="co">#&gt;    level                value terms        id                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> North_Ames         <span style="text-decoration: underline;">144</span>488. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> College_Creek      <span style="text-decoration: underline;">202</span>724. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Old_Town           <span style="text-decoration: underline;">125</span>183. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Edwards            <span style="text-decoration: underline;">130</span>698. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Somerset           <span style="text-decoration: underline;">232</span>135. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Northridge_Heights <span style="text-decoration: underline;">320</span>533. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Gilbert            <span style="text-decoration: underline;">191</span>145. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Sawyer             <span style="text-decoration: underline;">137</span>433. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Northwest_Ames     <span style="text-decoration: underline;">188</span>722. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Sawyer_West        <span style="text-decoration: underline;">182</span>683. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">level</span> <span class="op">==</span> <span class="st">"..new"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   level   value terms        id                 </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ..new <span style="text-decoration: underline;">183</span>225. Neighborhood lencode_mixed_AmBz1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-pooling-methods">Comparing Pooling Methods<a class="anchor" aria-label="anchor" href="#comparing-pooling-methods"></a>
</h3>
<p>Let’s visualize how partial pooling affects the estimates:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`no pooling` <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">mixed_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`partial pooling` <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"level"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"level"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">`no pooling`</span>, <span class="va">`partial pooling`</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray50"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"sqrt(n)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="categorical-encoding-01_files/figure-html/compare-pooling-1.png" class="r-plt" alt="Comparison of GLM (no pooling) versus mixed effects (partial pooling) encodings. Point size represents the number of observations in each neighborhood. Points below the diagonal indicate shrinkage toward the mean." width="672"><p class="caption">
Comparison of GLM (no pooling) versus mixed effects (partial pooling)
encodings. Point size represents the number of observations in each
neighborhood. Points below the diagonal indicate shrinkage toward the
mean.
</p>
</div>
<p>Neighborhoods with fewer observations (smaller points) show more
shrinkage—their partial pooling estimates are pulled toward the diagonal
(overall mean). Neighborhoods with many observations retain estimates
close to the unpooled GLM values.</p>
</div>
<div class="section level3">
<h3 id="bayesian-effect-encoding">Bayesian Effect Encoding<a class="anchor" aria-label="anchor" href="#bayesian-effect-encoding"></a>
</h3>
<p>For the most principled uncertainty quantification,
<code><a href="../reference/step_lencode_bayes.html">step_lencode_bayes()</a></code> uses a fully Bayesian approach
(requires the <code>rstanarm</code> package):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_bayes</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_lencode_bayes.html">step_lencode_bayes</a></span><span class="op">(</span><span class="va">Neighborhood</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html" class="external-link">step_interact</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html" class="external-link">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="feature-hashing">Feature Hashing<a class="anchor" aria-label="anchor" href="#feature-hashing"></a>
</h2>
<p>An alternative approach for high-cardinality categoricals is
<em>feature hashing</em> (the “hashing trick”). This uses a hash
function to map categories to a fixed number of columns:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_hashed</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Hash <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">hash</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_hashed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">Hash</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   Neighborhood    Hash                            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> North_Ames      076543f71313e522efe157944169d919</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> North_Ames      076543f71313e522efe157944169d919</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Briardale       b598bec306983e3e68a3118952df8cf0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Briardale       b598bec306983e3e68a3118952df8cf0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Northpark_Villa 6af95b5db968bf393e78188a81e0e1e4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Northpark_Villa 6af95b5db968bf393e78188a81e0e1e4</span></span></code></pre></div>
<p>We can reduce these to a smaller number of bins using the modulo
operation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_hashed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Hash <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">Hash</span>, <span class="fl">26</span>, <span class="fl">32</span><span class="op">)</span>, base <span class="op">=</span> <span class="fl">16L</span><span class="op">)</span>,</span>
<span>    Hash <span class="op">=</span> <span class="va">Hash</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">16</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">Hash</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">#&gt;    Neighborhood     Hash</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> North_Ames          9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> North_Ames          9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Briardale           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Briardale           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Northpark_Villa     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Northpark_Villa     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Sawyer_West         9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Sawyer_West         9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Sawyer              8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Sawyer              8</span></span></code></pre></div>
<p>The <code>textrecipes</code> package provides
<code>step_dummy_hash()</code> for this approach. Note that
<code>embedmit</code> previously provided
<code><a href="../reference/step_feature_hash.html">step_feature_hash()</a></code> but this is now deprecated in favor of
<code>textrecipes::step_dummy_hash()</code>.</p>
</div>
<div class="section level2">
<h2 id="more-encoding-options">More Encoding Options<a class="anchor" aria-label="anchor" href="#more-encoding-options"></a>
</h2>
<p>The <code>embedmit</code> package offers additional encoding
methods:</p>
<table class="table">
<colgroup>
<col width="43%">
<col width="56%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/step_lencode_glm.html">step_lencode_glm()</a></code></td>
<td>GLM-based effect encoding (no pooling)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_lencode_mixed.html">step_lencode_mixed()</a></code></td>
<td>Mixed effects encoding (partial pooling)</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/step_lencode_bayes.html">step_lencode_bayes()</a></code></td>
<td>Bayesian encoding (full uncertainty quantification)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_woe.html">step_woe()</a></code></td>
<td>Weight of evidence transformation (binary outcomes)</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/step_umap.html">step_umap()</a></code></td>
<td>UMAP embeddings via uwotlite</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="chapter-summary">Chapter Summary<a class="anchor" aria-label="anchor" href="#chapter-summary"></a>
</h2>
<p>Encoding categorical predictors is a fundamental preprocessing step
for many models:</p>
<ul>
<li>
<strong>Dummy variables</strong> work well for low-cardinality
categoricals but create many columns for high-cardinality variables</li>
<li>
<strong>Effect encodings</strong> replace categories with a single
numeric value representing the outcome relationship, handling high
cardinality elegantly</li>
<li>
<strong>Partial pooling</strong> (via
<code><a href="../reference/step_lencode_mixed.html">step_lencode_mixed()</a></code>) provides regularization for
categories with few observations</li>
<li>
<strong>Feature hashing</strong> offers a fast, memory-efficient
alternative that works well for very high cardinality</li>
<li>Tree-based models often work better with untransformed categorical
variables</li>
</ul>
<p>The choice of encoding strategy depends on:</p>
<ol style="list-style-type: decimal">
<li>The model being used</li>
<li>The cardinality of categorical variables</li>
<li>Whether interpretability is important</li>
<li>How novel categories should be handled at prediction time</li>
</ol>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Kuhn, M., &amp; Johnson, K. (2019). <em>Feature Engineering and
Selection</em>. CRC Press.</li>
<li>Kuhn, M., &amp; Silge, J. (2022). <em>Tidy Modeling with R</em>.
O’Reilly Media.</li>
<li>Micci-Barreca, D. (2001). A preprocessing scheme for
high-cardinality categorical attributes in classification and prediction
problems. <em>ACM SIGKDD Explorations</em>, 3(1), 27-32.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, Max Kuhn, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
