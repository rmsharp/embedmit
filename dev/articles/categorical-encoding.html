<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Encoding Categorical Data • embedmit</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="categorical-encoding_files/libs/quarto-html/popper.min.js"></script><script src="categorical-encoding_files/libs/quarto-html/tippy.umd.min.js"></script><link href="categorical-encoding_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="categorical-encoding_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Encoding Categorical Data">
<meta property="og:image" content="https://rmsharp.github.io/embedmit/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">embedmit</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/categorical-encoding-01.html">Encoding Categorical Data</a></li>
    <li><a class="dropdown-item" href="../articles/categorical-encoding.html">Encoding Categorical Data</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/GLM.html">Using Generalized Linear Models</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/Tensorflow.html">Entity Embeddings of Categorical Variables using TensorFlow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rmsharp/embedmit/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Encoding Categorical Data</h1>
      <p class="subtitle">Effect Encodings with embedmit</p>
      <p class="author">Based on Chapter 17 of Tidy Modeling with R</p>


      <small class="dont-index">Source: <a href="https://github.com/rmsharp/embedmit/blob/main/vignettes/categorical-encoding.qmd" class="external-link"><code>vignettes/categorical-encoding.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>This vignette demonstrates categorical encoding techniques using <code>embedmit</code>, closely following <a href="https://www.tmwr.org/categorical" class="external-link">Chapter 17 of Tidy Modeling with R</a> by Max Kuhn and Julia Silge.</p>
<section class="level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>For statistical modeling in R, the preferred representation for categorical or nominal data is a <em>factor</em>, which is a variable that can take on a limited number of different values. Internally, factors are stored as a vector of integer values together with a set of text labels.</p>
<p>The most straightforward approach for transforming a categorical variable to a numeric representation is to create dummy or indicator variables from the levels. However, this approach does not work well when you have a variable with high cardinality (too many levels) or when you may encounter novel values at prediction time (new levels).</p>
<p>This vignette explores alternative encoding strategies that address these challenges.</p>
</section><section class="level2"><h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmsharp/embedmit" class="external-link">embedmit</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the Ames housing data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create train/test split</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">502</span><span class="op">)</span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span><span class="va">ames</span>, prop <span class="op">=</span> <span class="fl">0.80</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
</section><section class="level2"><h2 id="is-an-encoding-necessary">Is an Encoding Necessary?<a class="anchor" aria-label="anchor" href="#is-an-encoding-necessary"></a>
</h2>
<p>A minority of models, such as those based on trees or rules, can handle categorical data natively and do not require encoding or transformation of these kinds of features. For example:</p>
<ul>
<li>
<strong>Tree-based models</strong> (decision trees, random forests, boosted trees) can find optimal splits on categorical variables directly</li>
<li>
<strong>Naive Bayes</strong> models compute class probabilities without requiring numeric encoding</li>
</ul>
<p>For these models, research has shown that creating dummy variables typically does not improve performance and can increase computation time. The <code>recipes</code> package provides <code><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy()</a></code> for standard dummy encoding when it is needed.</p>
</section><section class="level2"><h2 id="using-the-outcome-for-encoding-predictors">Using the Outcome for Encoding Predictors<a class="anchor" aria-label="anchor" href="#using-the-outcome-for-encoding-predictors"></a>
</h2>
<p>There are multiple options for encodings more complex than dummy or indicator variables. One method called <em>effect</em> or <em>likelihood encodings</em> replaces the original categorical variables with a single numeric column that measures the effect of those data.</p>
<p>For example, for the Ames housing data, we can compute the mean or median sale price for each neighborhood and use this value to represent that categorical level. Effect encodings can also seamlessly handle situations where a novel factor level is encountered in the data.</p>
<section class="level3"><h3 id="visualizing-neighborhood-effects">Visualizing Neighborhood Effects<a class="anchor" aria-label="anchor" href="#visualizing-neighborhood-effects"></a>
</h3>
<p>The Ames data has 28 different neighborhoods. Let’s visualize how sale price varies across them:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span>,</span>
<span>    std_err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">mean</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="fl">1.64</span> <span class="op">*</span> <span class="va">std_err</span>, xmax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="fl">1.64</span> <span class="op">*</span> <span class="va">std_err</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"Price (mean, log scale)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="categorical-encoding_files/figure-html/neighborhood-viz-1.png" width="672"></p>
<figcaption>Mean sale price by neighborhood with 90% confidence intervals. Neighborhoods are ordered by their mean sale price.</figcaption></figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="glm-based-effect-encoding">GLM-Based Effect Encoding<a class="anchor" aria-label="anchor" href="#glm-based-effect-encoding"></a>
</h3>
<p>The <code><a href="../reference/step_lencode_glm.html">step_lencode_glm()</a></code> function uses a generalized linear model to estimate the effect of each category level:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_glm</span> <span class="op">&lt;-</span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_lencode_glm.html">step_lencode_glm</a></span><span class="op">(</span><span class="va">Neighborhood</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html" class="external-link">step_interact</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html" class="external-link">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_glm</span></span></code></pre></div>
</details>
</div>
<p>We can examine the learned encodings by preparing the recipe and using <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_estimates</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">ames_glm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_estimates</span></span>
<span><span class="co">#&gt; # A tibble: 29 × 4</span></span>
<span><span class="co">#&gt;    level                value terms        id               </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;            </span></span>
<span><span class="co">#&gt;  1 North_Ames         144416. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  2 College_Creek      202763. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  3 Old_Town           124999. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  4 Edwards            130460. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  5 Somerset           232310. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  6 Northridge_Heights 321119. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  7 Gilbert            191159. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  8 Sawyer             137208. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt;  9 Northwest_Ames     188726. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; 10 Sawyer_West        182651. Neighborhood lencode_glm_yj20u</span></span>
<span><span class="co">#&gt; # ℹ 19 more rows</span></span></code></pre></div>
</details>
</div>
<p>Each neighborhood is replaced by a single numeric value representing its effect on sale price.</p>
</section><section class="level3"><h3 id="handling-novel-categories">Handling Novel Categories<a class="anchor" aria-label="anchor" href="#handling-novel-categories"></a>
</h3>
<p>Effect encodings can seamlessly handle situations where a novel factor level is encountered in the data. The encoding includes a special <code>..new</code> level:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">level</span> <span class="op">==</span> <span class="st">"..new"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   level   value terms        id               </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;            </span></span>
<span><span class="co">#&gt; 1 ..new 183150. Neighborhood lencode_glm_yj20u</span></span></code></pre></div>
</details>
</div>
<p>When the model encounters an unseen neighborhood at prediction time, it uses this default encoding.</p>
</section></section><section class="level2"><h2 id="effect-encodings-with-partial-pooling">Effect Encodings with Partial Pooling<a class="anchor" aria-label="anchor" href="#effect-encodings-with-partial-pooling"></a>
</h2>
<p>Creating an effect encoding with <code><a href="../reference/step_lencode_glm.html">step_lencode_glm()</a></code> estimates the effect separately for each factor level (in this case, neighborhood). However, some of these neighborhoods have many houses in them, and some have only a few. There is much more uncertainty in our measurement of price for neighborhoods with few training set homes than for neighborhoods with many.</p>
<p>We can use <em>partial pooling</em> to adjust these estimates so that levels with small sample sizes are shrunk toward the overall mean. The <code><a href="../reference/step_lencode_mixed.html">step_lencode_mixed()</a></code> function uses hierarchical or mixed effects models to accomplish this:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_mixed</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_lencode_mixed.html">step_lencode_mixed</a></span><span class="op">(</span><span class="va">Neighborhood</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html" class="external-link">step_interact</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html" class="external-link">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_mixed</span></span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_estimates</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">ames_mixed</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mixed_estimates</span></span>
<span><span class="co">#&gt; # A tibble: 29 × 4</span></span>
<span><span class="co">#&gt;    level                value terms        id                 </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;              </span></span>
<span><span class="co">#&gt;  1 North_Ames         144488. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  2 College_Creek      202724. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  3 Old_Town           125183. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  4 Edwards            130698. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  5 Somerset           232135. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  6 Northridge_Heights 320533. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  7 Gilbert            191145. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  8 Sawyer             137433. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt;  9 Northwest_Ames     188722. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; 10 Sawyer_West        182683. Neighborhood lencode_mixed_AmBz1</span></span>
<span><span class="co">#&gt; # ℹ 19 more rows</span></span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">level</span> <span class="op">==</span> <span class="st">"..new"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   level   value terms        id                 </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;              </span></span>
<span><span class="co">#&gt; 1 ..new 183225. Neighborhood lencode_mixed_AmBz1</span></span></code></pre></div>
</details>
</div>
<section class="level3"><h3 id="comparing-pooling-methods">Comparing Pooling Methods<a class="anchor" aria-label="anchor" href="#comparing-pooling-methods"></a>
</h3>
<p>Let’s visualize how partial pooling affects the estimates:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`no pooling` <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">mixed_estimates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`partial pooling` <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"level"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"level"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">`no pooling`</span>, <span class="va">`partial pooling`</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray50"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"sqrt(n)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="categorical-encoding_files/figure-html/compare-pooling-1.png" width="672"></p>
<figcaption>Comparison of GLM (no pooling) versus mixed effects (partial pooling) encodings. Point size represents the number of observations in each neighborhood.</figcaption></figure>
</div>
</div>
</div>
<p>When we use partial pooling, we shrink the effect estimates toward the mean because we don’t have as much evidence about the price in neighborhoods with few observations. Neighborhoods with many observations retain estimates close to the unpooled GLM values.</p>
</section><section class="level3"><h3 id="bayesian-effect-encoding">Bayesian Effect Encoding<a class="anchor" aria-label="anchor" href="#bayesian-effect-encoding"></a>
</h3>
<p>For fully Bayesian uncertainty quantification, <code><a href="../reference/step_lencode_bayes.html">step_lencode_bayes()</a></code> provides an alternative approach (requires the <code>rstanarm</code> package):</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_bayes</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>           <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_lencode_bayes.html">step_lencode_bayes</a></span><span class="op">(</span><span class="va">Neighborhood</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_interact.html" class="external-link">step_interact</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_ns.html" class="external-link">step_ns</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
</section></section><section class="level2"><h2 id="feature-hashing">Feature Hashing<a class="anchor" aria-label="anchor" href="#feature-hashing"></a>
</h2>
<p><em>Feature hashing</em> methods also create dummy variables, but only consider the value of the category to assign it to a predefined pool of dummy variables. A hashing function takes an input of variable size and maps it to an output of fixed size.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_hashed</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Hash <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">hash</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_hashed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">Hash</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   Neighborhood    Hash                            </span></span>
<span><span class="co">#&gt;   &lt;fct&gt;           &lt;chr&gt;                           </span></span>
<span><span class="co">#&gt; 1 North_Ames      076543f71313e522efe157944169d919</span></span>
<span><span class="co">#&gt; 2 North_Ames      076543f71313e522efe157944169d919</span></span>
<span><span class="co">#&gt; 3 Briardale       b598bec306983e3e68a3118952df8cf0</span></span>
<span><span class="co">#&gt; 4 Briardale       b598bec306983e3e68a3118952df8cf0</span></span>
<span><span class="co">#&gt; 5 Northpark_Villa 6af95b5db968bf393e78188a81e0e1e4</span></span>
<span><span class="co">#&gt; 6 Northpark_Villa 6af95b5db968bf393e78188a81e0e1e4</span></span></code></pre></div>
</details>
</div>
<p>In feature hashing, the number of possible hashes is a hyperparameter and is set by the model developer through computing the modulo of the integer hashes:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_hashed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Hash <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">Hash</span>, <span class="fl">26</span>, <span class="fl">32</span><span class="op">)</span>, base <span class="op">=</span> <span class="fl">16L</span><span class="op">)</span>,</span>
<span>    Hash <span class="op">=</span> <span class="va">Hash</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">16</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Neighborhood</span>, <span class="va">Hash</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span><span class="co">#&gt;    Neighborhood     Hash</span></span>
<span><span class="co">#&gt;    &lt;fct&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 North_Ames          9</span></span>
<span><span class="co">#&gt;  2 North_Ames          9</span></span>
<span><span class="co">#&gt;  3 Briardale           0</span></span>
<span><span class="co">#&gt;  4 Briardale           0</span></span>
<span><span class="co">#&gt;  5 Northpark_Villa     4</span></span>
<span><span class="co">#&gt;  6 Northpark_Villa     4</span></span>
<span><span class="co">#&gt;  7 Sawyer_West         9</span></span>
<span><span class="co">#&gt;  8 Sawyer_West         9</span></span>
<span><span class="co">#&gt;  9 Sawyer              8</span></span>
<span><span class="co">#&gt; 10 Sawyer              8</span></span></code></pre></div>
</details>
</div>
<p>Feature hashing can handle new category levels at prediction time, since it does not rely on pre-determined dummy variables. The <code>textrecipes</code> package provides <code>step_dummy_hash()</code> for this approach.</p>
</section><section class="level2"><h2 id="more-encoding-options">More Encoding Options<a class="anchor" aria-label="anchor" href="#more-encoding-options"></a>
</h2>
<p>The <code>embedmit</code> package offers additional encoding methods:</p>
<table class="table caption-top">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/step_lencode_glm.html">step_lencode_glm()</a></code></td>
<td>GLM-based effect encoding (no pooling)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_lencode_mixed.html">step_lencode_mixed()</a></code></td>
<td>Mixed effects encoding (partial pooling)</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/step_lencode_bayes.html">step_lencode_bayes()</a></code></td>
<td>Bayesian encoding (full uncertainty quantification)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/step_woe.html">step_woe()</a></code></td>
<td>Weight of evidence transformation (binary outcomes)</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/step_umap.html">step_umap()</a></code></td>
<td>UMAP embeddings via uwotlite</td>
</tr>
</tbody>
</table></section><section class="level2"><h2 id="chapter-summary">Chapter Summary<a class="anchor" aria-label="anchor" href="#chapter-summary"></a>
</h2>
<p>The most straightforward option for transforming a categorical variable to a numeric representation is to create dummy variables from the levels, but this option does not work well when you have a variable with high cardinality (too many levels) or when you may see novel values at prediction time (new levels).</p>
<p>Effect encodings and feature hashing address these challenges:</p>
<ul>
<li>
<strong>Effect encodings</strong> replace categories with a single numeric value measuring the outcome relationship</li>
<li>
<strong>Partial pooling</strong> (via <code><a href="../reference/step_lencode_mixed.html">step_lencode_mixed()</a></code>) adjusts estimates so that levels with small sample sizes are shrunk toward the overall mean</li>
<li>
<strong>Feature hashing</strong> maps categories to a predefined pool of dummy variables and can handle novel categories</li>
</ul>
<p>Other options include entity embeddings (learned via a neural network with <code><a href="../reference/step_embed.html">step_embed()</a></code>) and weight of evidence transformation (via <code><a href="../reference/step_woe.html">step_woe()</a></code>).</p>
</section><section class="level2"><h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Kuhn, M., &amp; Johnson, K. (2019). <em>Feature Engineering and Selection</em>. CRC Press.</li>
<li>Kuhn, M., &amp; Silge, J. (2022). <em>Tidy Modeling with R</em>. O’Reilly Media.</li>
<li>Micci-Barreca, D. (2001). A preprocessing scheme for high-cardinality categorical attributes in classification and prediction problems. <em>ACM SIGKDD Explorations</em>, 3(1), 27-32.</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emil Hvitfeldt, Max Kuhn, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
